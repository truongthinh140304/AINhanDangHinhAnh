╔════════════════════════════════════════════════════════════════╗
║         🐘 POSTGRESQL - HƯỚNG DẪN NHANH 5 PHÚT                ║
╚════════════════════════════════════════════════════════════════╝

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  BƯỚC 1: CÀI ĐẶT POSTGRESQL (10 PHÚT)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🌐 DOWNLOAD:
   https://www.postgresql.org/download/windows/

📥 CÁCH CÀI:
   1. Download PostgreSQL 16 Installer
   2. Run file .exe
   3. Click Next → Next
   4. ĐẶT PASSWORD: postgres (NHỚ PASSWORD NÀY!)
   5. Port: 5432 (giữ mặc định)
   6. Click Next → Install
   7. Đợi 5 phút
   8. ✅ Xong!

✅ KIỂM TRA:
   # Mở Command Prompt
   psql --version
   
   # Kết quả: psql (PostgreSQL) 16.x


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  BƯỚC 2: TẠO DATABASE (2 PHÚT)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

CÁCH 1: Dùng pgAdmin (DỄ NHẤT ⭐)
   1. Start Menu → pgAdmin 4
   2. Nhập password: postgres
   3. Right-click "Databases" → Create → Database
   4. Name: nhandanghinhanh
   5. Click Save
   6. ✅ Xong!

CÁCH 2: Command Line
   # Mở Command Prompt
   psql -U postgres
   
   # Nhập password: postgres
   
   # Tạo database
   CREATE DATABASE nhandanghinhanh;
   
   # Thoát
   \q


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  BƯỚC 3: CẤU HÌNH BACKEND (1 PHÚT)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📝 TẠO FILE .env:
   cd backend
   copy .env.example .env

📝 CHỈNH SỬA FILE .env:
   # Mở file backend/.env trong Notepad/VS Code
   
   DATABASE_URL=postgresql://postgres:postgres@localhost:5432/nhandanghinhanh
   DB_HOST=localhost
   DB_PORT=5432
   DB_NAME=nhandanghinhanh
   DB_USER=postgres
   DB_PASSWORD=postgres
   
   ⚠️ Thay "postgres" thứ 2 bằng PASSWORD bạn đã đặt!


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  BƯỚC 4: CÀI PACKAGES (1 PHÚT)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

cd backend

# Activate venv (nếu có)
venv\Scripts\activate

# Cài packages
pip install -r requirements.txt

# Đợi cài đặt (30 giây)


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  BƯỚC 5: KHỞI TẠO DATABASE (30 GIÂY)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

CÁCH 1: Tự động (khi chạy server)
   cd backend
   python main.py
   
   ✅ Server sẽ tự tạo tables!

CÁCH 2: Chạy script riêng
   cd backend
   python init_db.py
   
   ✅ Tables được tạo!


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  BƯỚC 6: TEST (30 GIÂY)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🧪 TEST CONNECTION:
   cd backend
   python test_db.py
   
   ✅ Thấy "ALL TESTS COMPLETED!" → THÀNH CÔNG!

🌐 TEST API:
   cd backend
   python main.py
   
   # Mở browser:
   http://localhost:8000/docs
   
   # Thử endpoint:
   POST /api/recognize → Upload ảnh
   GET /api/history → Xem lịch sử
   
   ✅ Thấy dữ liệu → THÀNH CÔNG!


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ✅ HOÀN THÀNH!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Bạn đã có:
  ✅ PostgreSQL server
  ✅ Database "nhandanghinhanh"
  ✅ Backend kết nối database
  ✅ API lưu dữ liệu vào PostgreSQL

Sử dụng:
  1. Upload ảnh qua API
  2. Xem lịch sử trong /api/history
  3. Xem database trong pgAdmin
  4. Query dữ liệu bằng SQL


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  📊 CẤU TRÚC DATABASE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Tables:
  📋 users                → Người dùng
  📸 recognition_history  → Lịch sử nhận dạng
  👤 detected_persons     → Người được phát hiện
  📦 detected_objects     → Vật dụng được phát hiện
  📊 daily_statistics     → Thống kê hàng ngày
  📝 system_logs          → Logs hệ thống


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  🔧 XỬ LÝ LỖI THƯỜNG GẶP
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

❌ "connection refused"
   → PostgreSQL chưa chạy
   → Fix: services.msc → tìm postgresql → Start

❌ "password authentication failed"
   → Password sai trong .env
   → Fix: Kiểm tra lại password

❌ "database does not exist"
   → Chưa tạo database
   → Fix: Chạy lại BƯỚC 2

❌ "psycopg2 not found"
   → Package chưa cài
   → Fix: pip install psycopg2-binary

❌ "relation does not exist"
   → Tables chưa tạo
   → Fix: python init_db.py


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  💡 TIPS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Xem dữ liệu trong pgAdmin:
   pgAdmin 4 → nhandanghinhanh → Tables
   → Right-click table → View/Edit Data

2. Query SQL trực tiếp:
   psql -U postgres -d nhandanghinhanh
   SELECT * FROM recognition_history;

3. Backup database:
   pg_dump -U postgres nhandanghinhanh > backup.sql

4. Restore database:
   psql -U postgres nhandanghinhanh < backup.sql

5. Reset database (XÓA TẤT CẢ):
   cd backend
   python init_db.py --reset


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  📖 TÀI LIỆU CHI TIẾT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📄 HUONG_DAN_POSTGRESQL.md  ← Hướng dẫn đầy đủ chi tiết
📄 backend/database.py      ← Database configuration
📄 backend/models.py         ← Database schema
📄 backend/init_db.py        ← Setup script
📄 backend/test_db.py        ← Test script


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  🚀 WORKFLOW HÀNG NGÀY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Kiểm tra PostgreSQL chạy:
   services.msc → postgresql → Running

2. Chạy backend:
   cd backend
   python main.py

3. Upload ảnh qua Flutter app

4. Xem dữ liệu:
   - API: http://localhost:8000/api/history
   - pgAdmin: Databases → nhandanghinhanh


═══════════════════════════════════════════════════════════════════

         🎉 Chúc bạn sử dụng PostgreSQL thành công! 🎉

═══════════════════════════════════════════════════════════════════

